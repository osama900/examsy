<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„ØªØ´ÙÙŠØ± Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ø³Ù„ÙˆØ¨Ø¨ Ø§Ù„Ø³ÙƒØ© Ø§Ù„Ø­Ø¯ÙŠØ¯ÙŠØ©</title>
  <link rel="stylesheet" href="../../../css/style.css" />
  <!-- Adjust the path as needed -->
</head>

<body>
  <div class="headerdiv">
    <header class="main-header">
      <div class="header-content">
        <a href="../../../index.html" class="logo-link">
          <span class="logo-emoji">ğŸ“š</span>
          <span class="logo-text">Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ø§Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ©</span>
        </a>
      </div>
    </header>
  </div>
  <h1 class="h1rail">Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„ØªØ´ÙÙŠØ± Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ø³Ù„ÙˆØ¨ Ø§Ù„Ø³ÙƒØ© Ø§Ù„Ø­Ø¯ÙŠØ¯ÙŠØ©</h1>

  <!-- Encryption Section -->
  <h2 style="text-align: center; color: #2c3e50;">Ø§Ù„ØªØ´ÙÙŠØ±</h2>
  <div class="rail-container">
    <div class="io-container">
      <textarea id="inputTextEncrypt" placeholder="Ø§Ø¯Ø®Ù„ Ø§Ù„Ù†Øµ Ù„Ù„ØªØ´ÙÙŠØ± - Ø§Ù„Ù†Øµ Ø§Ù„Ø§ØµÙ„ÙŠ"></textarea>
      <div class="controls">
        <input type="number" id="railsEncrypt" min="2" value="3" placeholder="Ø§Ù„Ù…ÙØªØ§Ø­ " />
        <label>Ø§Ø¯Ø®Ù„ Ø§Ù„Ù…ÙØªØ§Ø­ Ù‡Ù†Ø§</label>
        <button onclick="encrypt()">ØªØ´ÙÙŠÙ€Ù€Ù€Ù€Ø±</button>
      </div>
      <textarea id="outputTextEncrypt" readonly placeholder="Ø§Ù„Ù†Øµ Ø§Ù„Ù…Ø´ÙØ± Ø³ÙŠÙƒÙˆÙ† Ù‡Ù†Ø§"></textarea>
    </div>

    <div class="visualization" id="visualizationEncrypt">
      <p style="text-align: center; color: #666">Ø§Ù„ØªÙ…Ø«ÙŠÙ„ Ø§Ù„Ù…Ø±Ø¦ÙŠ Ù„Ù„ØªØ´ÙÙŠØ±</p>
    </div>
  </div>

  <!-- Decryption Section -->
  <h2 style="text-align: center; color: #2c3e50;">ÙÙƒ Ø§Ù„ØªØ´ÙÙŠØ±</h2>
  <div class="rail-container">
    <div class="io-container">
      <textarea id="inputTextDecrypt" placeholder="Ø§Ø¯Ø®Ù„ Ø§Ù„Ù†Øµ Ø§Ù„Ù…Ø´ÙØ± Ù„ÙÙƒ ØªØ´ÙÙŠØ±Ù‡"></textarea>
      <div class="controls">
        <input type="number" id="railsDecrypt" min="2" value="3" placeholder="Ø§Ù„Ù…ÙØªØ§Ø­ " />
        <label>Ø§Ø¯Ø®Ù„ Ø§Ù„Ù…ÙØªØ§Ø­ Ù‡Ù†Ø§</label>
        <button onclick="decrypt()">ÙÙ€Ù€Ù€Ùƒ ØªØ´ÙÙŠÙ€Ù€Ù€Ù€Ø±</button>
      </div>
      <textarea id="outputTextDecrypt" readonly placeholder="Ø§Ù„Ù†Øµ Ø§Ù„Ø§ØµÙ„ÙŠ Ø³ÙŠÙƒÙˆÙ† Ù‡Ù†Ø§"></textarea>
    </div>

    <div class="visualization" id="visualizationDecrypt">
      <p style="text-align: center; color: #666">Ø§Ù„ØªÙ…Ø«ÙŠÙ„ Ø§Ù„Ù…Ø±Ø¦ÙŠ Ù„ÙÙƒ Ø§Ù„ØªØ´ÙÙŠØ±</p>
    </div>
  </div>
  <footer>Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© Â© Teacher Osama Omar</footer>

  <script>
    function encrypt() {
      const text = document.getElementById("inputTextEncrypt").value;
      const rails = parseInt(document.getElementById("railsEncrypt").value) || 3;
      const { ciphertext, matrix, order } = railFenceEncrypt(text, rails);
      document.getElementById("outputTextEncrypt").value = ciphertext;
      visualizeZigzag(text, rails, order, "visualizationEncrypt");
    }

    function decrypt() {
      const text = document.getElementById("inputTextDecrypt").value;
      const rails = parseInt(document.getElementById("railsDecrypt").value) || 3;
      const { plaintext, matrix, order } = railFenceDecrypt(text, rails);
      document.getElementById("outputTextDecrypt").value = plaintext;
      visualizeZigzag(plaintext, rails, order, "visualizationDecrypt");
    }

    function railFenceEncrypt(text, rails) {
      if (rails < 2) return { ciphertext: text, matrix: [], order: [] };
      const matrix = Array.from({ length: rails }, () =>
        Array(text.length).fill("")
      );
      let row = 0,
        dir = 1;
      const order = [];

      for (let i = 0; i < text.length; i++) {
        matrix[row][i] = text[i];
        order.push({ row, col: i });
        row += dir;
        if (row === rails - 1 || row === 0) dir *= -1;
      }

      return {
        ciphertext: matrix
          .flat()
          .filter((c) => c !== "")
          .join(""),
        matrix,
        order,
      };
    }

    function railFenceDecrypt(ciphertext, rails) {
      if (rails < 2) return { plaintext: ciphertext, matrix: [], order: [] };
      const matrix = Array.from({ length: rails }, () =>
        Array(ciphertext.length).fill("")
      );
      let row = 0,
        dir = 1;
      const order = [];

      for (let i = 0; i < ciphertext.length; i++) {
        order.push({ row, col: i });
        row += dir;
        if (row === rails - 1 || row === 0) dir *= -1;
      }

      let charIndex = 0;
      for (let r = 0; r < rails; r++) {
        for (let c = 0; c < ciphertext.length; c++) {
          if (
            matrix[r][c] === "" &&
            order.some((o) => o.row === r && o.col === c)
          ) {
            matrix[r][c] = ciphertext[charIndex++];
          }
        }
      }

      const plaintext = order.map((o) => matrix[o.row][o.col]).join("");
      return { plaintext, matrix, order };
    }

    function visualizeZigzag(text, rails, order, targetId) {
      const vis = document.getElementById(targetId);
      vis.innerHTML = "";

      const grid = document.createElement("div");
      grid.className = "zigzag-grid";

      const cellElements = [];

      for (let r = 0; r < rails; r++) {
        const rowDiv = document.createElement("div");
        rowDiv.className = "rail-row";

        const railNum = document.createElement("div");
        railNum.className = "rail-number";
        railNum.textContent = `R${r + 1}`;
        rowDiv.appendChild(railNum);

        for (let c = 0; c < text.length; c++) {
          const cell = document.createElement("div");
          cell.className = "cell";

          const pos = order.find((o) => o.row === r && o.col === c);
          if (pos) {
            cell.className += " active";
            cell.textContent = text[pos.col];
            const indexSpan = document.createElement("div");
            indexSpan.className = "index";
            indexSpan.textContent = pos.col + 1;
            cell.appendChild(indexSpan);
            cell.dataset.row = r;
            cell.dataset.col = c;
          }
          rowDiv.appendChild(cell);
          if (pos) cellElements.push(cell);
        }
        grid.appendChild(rowDiv);
      }

      vis.appendChild(grid);

      order.slice(0, -1).forEach((current, i) => {
        const next = order[i + 1];
        const currentEl = cellElements[i];
        const nextEl = cellElements[i + 1];

        if (currentEl && nextEl) {
          const arrow = document.createElement("span");
          arrow.className = "arrow";
          arrow.textContent = "â†’";

          const currRow = parseInt(currentEl.dataset.row);
          const currCol = parseInt(currentEl.dataset.col);
          const nextRow = parseInt(nextEl.dataset.row);
          const nextCol = parseInt(nextEl.dataset.col);

          const deltaRow = nextRow - currRow;
          const deltaCol = nextCol - currCol;
          let angle;

          if (deltaRow > 0 && deltaCol > 0) {
            angle = 45;
          } else if (deltaRow < 0 && deltaCol > 0) {
            angle = -45;
          } else {
            const deltaX = deltaCol * 35;
            const deltaY = deltaRow * 40;
            angle = Math.atan2(deltaY, deltaX) * (180 / Math.PI);
          }

          arrow.style.transform = `translateY(-50%) rotate(${angle}deg)`;
          currentEl.appendChild(arrow);
        }
      });
    }
  </script>
  <script>
    const PAGE_TIME_CONFIG = {
      pageId: "9-3-5-task3" // Unique ID for this page
    };
  </script>
  <script src="../../../js/time_tracker.js"></script>

</body>

</html>